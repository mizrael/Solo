<Window xmlns="https://github.com/avaloniaui"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:controls="clr-namespace:SpriteSheetEditor.Controls"
        xmlns:vm="clr-namespace:SpriteSheetEditor.ViewModels"
        xmlns:models="clr-namespace:SpriteSheetEditor.Models"
        x:Class="SpriteSheetEditor.MainWindow"
        Title="SpriteSheet Editor"
        Width="1200" Height="800"
        Background="#1e1e1e">

    <Grid RowDefinitions="Auto,Auto,*,Auto">
        <!-- Menu Bar -->
        <Menu Grid.Row="0" Background="#2d2d30">
            <MenuItem Header="_File">
                <MenuItem x:Name="LoadImagesMenuItem" Header="Load Images..." Click="OnLoadImagesClicked" InputGesture="Ctrl+O" />
                <MenuItem x:Name="SaveImageMenuItem" Header="Save Image..." Click="OnSaveImageClicked" IsEnabled="False" />
                <Separator />
                <MenuItem x:Name="ImportImagesMenuItem" Header="Import Images..." Click="OnImportImagesClicked" IsEnabled="False" />
                <Separator />
                <MenuItem Header="Open JSON..." Click="OnOpenJsonClicked" InputGesture="Ctrl+Shift+O" />
                <MenuItem x:Name="SaveJsonMenuItem" Header="Save JSON..." Click="OnSaveJsonClicked" IsEnabled="False" InputGesture="Ctrl+S" />
                <Separator />
                <MenuItem x:Name="CloseProjectMenuItem" Header="Close Project" Click="OnCloseProjectClicked" IsEnabled="False" />
            </MenuItem>
            <MenuItem Header="_Edit">
                <MenuItem x:Name="UndoMenuItem" Header="Undo" Click="OnUndoClicked" IsEnabled="False" InputGesture="Ctrl+Z" />
                <MenuItem x:Name="RedoMenuItem" Header="Redo" Click="OnRedoClicked" IsEnabled="False" InputGesture="Ctrl+Y" />
                <Separator />
                <MenuItem x:Name="FitToWindowMenuItem" Header="Fit to Window" Click="OnFitToWindowClicked" IsEnabled="False" />
                <Separator />
                <MenuItem x:Name="RearrangeMenuItem" Header="Rearrange Layout..." Click="OnRearrangeLayoutClicked" IsEnabled="False" />
            </MenuItem>
            <MenuItem Header="_Sprites">
                <MenuItem x:Name="SelectToolMenuItem" Header="Select" Click="OnSelectToolClicked" InputGesture="1" />
                <MenuItem x:Name="DrawToolMenuItem" Header="Draw" Click="OnDrawToolClicked" InputGesture="2" />
            </MenuItem>
            <MenuItem x:Name="FiltersMenu" Header="Filters" IsEnabled="False">
                <MenuItem Header="Color to Transparent" Click="OnColorToTransparentClicked" />
            </MenuItem>
            <MenuItem Header="_Animations">
                <MenuItem x:Name="NewAnimationMenuItem" Header="New Animation" Click="OnNewAnimationClicked" InputGesture="Ctrl+Shift+N" />
                <Separator />
                <MenuItem x:Name="ExportAnimationMenuItem" Header="Export Animation..." Click="OnExportAnimationClicked" IsEnabled="False" />
            </MenuItem>
            <MenuItem Header="_View">
                <MenuItem Header="Grid..." Click="OnGridClicked" InputGesture="Ctrl+G" />
            </MenuItem>
        </Menu>

        <!-- Filter Panel (initially hidden) -->
        <controls:FilterPanel x:Name="FilterPanel" Grid.Row="1" IsVisible="False"
                              ApplyClicked="OnFilterApplyClicked"
                              CancelClicked="OnFilterCancelClicked"
                              PickColorClicked="OnFilterPickColorClicked"
                              SettingsChanged="OnFilterSettingsChanged" />

        <!-- Main Content -->
        <Grid Grid.Row="2" ColumnDefinitions="*,280">
            <!-- Canvas Area -->
            <Grid Grid.Column="0" RowDefinitions="Auto,*">
                <TextBlock x:Name="DocumentLabel" Grid.Row="0" Text="No document loaded"
                           Foreground="#aaa" Background="#1e1e1e" Padding="8,4" FontSize="12" />
                <ScrollViewer x:Name="CanvasScrollViewer" Grid.Row="1"
                              HorizontalScrollBarVisibility="Auto"
                              VerticalScrollBarVisibility="Auto">
                    <controls:SpriteCanvas x:Name="Canvas"
                                           PanChanged="OnCanvasPanChanged" />
                </ScrollViewer>
            </Grid>

            <!-- Right Panel with Tabs -->
            <TabControl Grid.Column="1" Background="#252526">
                <!-- Sprites Tab -->
                <TabItem Header="Sprites">
                    <Grid RowDefinitions="*,Auto,*">
                        <!-- Sprite List -->
                        <Border Grid.Row="0" Margin="8" Padding="8" Background="#1e1e1e" BorderBrush="#3e3e42" BorderThickness="1" CornerRadius="4">
                            <Grid RowDefinitions="Auto,*">
                                <TextBlock Text="Sprites" FontWeight="Bold" Foreground="White" />
                                <ListBox Grid.Row="1" x:Name="SpriteListView"
                                         Background="Transparent"
                                         Foreground="White"
                                         SelectionChanged="OnSpriteSelectionChanged">
                                    <ListBox.ItemTemplate>
                                        <DataTemplate DataType="{x:Type models:SpriteDefinition}">
                                            <TextBlock Text="{Binding Name}" Foreground="White" Padding="4" />
                                        </DataTemplate>
                                    </ListBox.ItemTemplate>
                                </ListBox>
                            </Grid>
                        </Border>

                        <Rectangle Grid.Row="1" Height="1" Fill="#3e3e42" />

                        <!-- Properties Panel -->
                        <Border Grid.Row="2" Margin="8" Padding="8" Background="#1e1e1e" BorderBrush="#3e3e42" BorderThickness="1" CornerRadius="4">
                            <StackPanel Spacing="8">
                                <TextBlock Text="Properties" FontWeight="Bold" Foreground="White" />

                                <TextBlock Text="Name:" Foreground="#ccc" />
                                <TextBox x:Name="NameEntry" Background="#333" Foreground="White"
                                         LostFocus="OnNameEntryLostFocus" GotFocus="OnNameEntryGotFocus" />
                                <TextBlock x:Name="NameErrorLabel" Foreground="#ff6b6b" FontSize="11" IsVisible="False" />

                                <Grid ColumnDefinitions="*,*">
                                    <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                        <TextBlock Text="X:" Foreground="#ccc" />
                                        <TextBox x:Name="XEntry" Background="#333" Foreground="White" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                        <TextBlock Text="Y:" Foreground="#ccc" />
                                        <TextBox x:Name="YEntry" Background="#333" Foreground="White" />
                                    </StackPanel>
                                </Grid>

                                <Grid ColumnDefinitions="*,*">
                                    <StackPanel Grid.Column="0" Margin="0,0,4,0">
                                        <TextBlock Text="Width:" Foreground="#ccc" />
                                        <TextBox x:Name="WidthEntry" Background="#333" Foreground="White" />
                                    </StackPanel>
                                    <StackPanel Grid.Column="1" Margin="4,0,0,0">
                                        <TextBlock Text="Height:" Foreground="#ccc" />
                                        <TextBox x:Name="HeightEntry" Background="#333" Foreground="White" />
                                    </StackPanel>
                                </Grid>

                                <Button Content="Delete Sprite" Click="OnDeleteSpriteClicked"
                                        Background="#c42b1c" Foreground="White" HorizontalAlignment="Stretch" />
                            </StackPanel>
                        </Border>
                    </Grid>
                </TabItem>

                <!-- Animations Tab -->
                <TabItem Header="Animations">
                    <controls:AnimationPanel x:Name="AnimationPanel"
                                             NewAnimationClicked="OnAnimationPanelNewAnimationClicked"
                                             DeleteAnimationClicked="OnAnimationPanelDeleteAnimationClicked"
                                             AddFramesClicked="OnAnimationPanelAddFramesClicked"
                                             RemoveFrameClicked="OnAnimationPanelRemoveFrameClicked"
                                             ExportAnimationClicked="OnAnimationPanelExportClicked"
                                             AnimationPropertyChanged="OnAnimationPanelPropertyChanged" />
                </TabItem>
            </TabControl>
        </Grid>

        <!-- Status Bar -->
        <StackPanel Grid.Row="3" Orientation="Horizontal" Background="#007acc" Spacing="16">
            <TextBlock x:Name="ZoomLabel" Text="Zoom: 100%" Foreground="White" Padding="8,4" />
            <TextBlock x:Name="ImageSizeLabel" Text="Image: --" Foreground="White" Padding="8,4" />
            <TextBlock x:Name="SpriteCountLabel" Text="Sprites: 0" Foreground="White" Padding="8,4" />
        </StackPanel>
    </Grid>

</Window>
